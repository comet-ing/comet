#!/bin/bash

# Set common variables
INPUT_BOX_ADDRESS="0x593E5BCf894D6829Dd26D0810DA7F064406aebB6"
APPLICATION_ADDRESS="0xab7528bb862fb57e8a2bcd567a2e929a0be56a5e"
MNEMONIC="test test test test test test test test test test test junk"
RPC_URL="http://localhost:8545/"

# Function to send input using cast
send_input() {
    local input=$1
    local index=$2
    cast send \
        --mnemonic "$MNEMONIC" \
        --mnemonic-index $index \
        --rpc-url "$RPC_URL" \
        $INPUT_BOX_ADDRESS \
        "addInput(address,bytes)(bytes32)" $APPLICATION_ADDRESS $input
}

echo "Testing Comet Jam functions..."

# 1. Create a new Comet Jam
echo "1. Creating a new Comet Jam..."
CREATE_INPUT="7b22616374696f6e223a20226a616d2e637265617465222c226e616d65223a20224c6966652069732077696c64222c20226465736372697074696f6e22203a2022436f6d70617265206c696665207769746820616e20616e696d616c20696e206f6e65206c696e65222c20226d696e745072696365223a202233222c20226d6178456e7472696573223a20352c202267656e65736973456e747279223a20224c696665206973206173206d61676963616c20617320612072616262697420696e2061206861742e227d"
send_input $CREATE_INPUT 0

# 2. Append to the Comet Jam three times (using different accounts)
echo "2. Appending to the Comet Jam (2/5)..."
APPEND_INPUT_1="7b22616374696f6e223a20226a616d2e617070656e64222c20226a616d4944223a20302c2022656e747279223a224c696665206973206173206d6f6f20617320636f772c2063686577696e6720697420696e2061206c6f6f702e227d"
send_input $APPEND_INPUT_1 1

echo "   Appending to the Comet Jam (3/5)..."
APPEND_INPUT_2="7b22616374696f6e223a20226a616d2e617070656e64222c20226a616d4944223a20302c2022656e747279223a224c696665206973206173206368616f746963206173206120737175697272656c20696e20747261666669632c2064617274696e67206261636b20616e6420666f7274682c20686f70696e6720666f722074686520626573742e227d"
send_input $APPEND_INPUT_2 2

echo "   Appending to the Comet Jam (4/5)..."
APPEND_INPUT_3="7b22616374696f6e223a20226a616d2e617070656e64222c20226a616d4944223a20302c2022656e747279223a224c69666520697320617320627573792061732061206265652077697468206120746f2d646f206c6973742c2062757a7a696e6720616c6c207468652074696d65227d"
send_input $APPEND_INPUT_3 3

echo "   Appending to the Comet Jam (5/5)..."
APPEND_INPUT_4="7b22616374696f6e223a20226a616d2e617070656e64222c20226a616d4944223a20302c2022656e747279223a224c696665206973206173206c6f6164656420617320616e20616e74227d"
send_input $APPEND_INPUT_4 4

# 3. Simple Ether deposit to the dApp
echo "3. Performing simple Ether deposit to the dApp..."
cast send \
    --mnemonic "$MNEMONIC" \
    --mnemonic-index 0 \
    --rpc-url "$RPC_URL" \
    0xfa2292f6D85ea4e629B156A4f99219e30D12EE17 \
    "depositEther(address,bytes)" \
    $APPLICATION_ADDRESS \
    0x \
    --value 2ether

# Set NFT address
echo "Setting NFT address..."
NFT_ADDRESS_INPUT="7b22616374696f6e223a226a616d2e7365744e465441646472657373222c202261646472657373223a22307837313235313665363143384233383364463441363343466538336437373031426365353442303365227d"
send_input $NFT_ADDRESS_INPUT 0

# 4. Ether Deposit to Mint a Comet
echo "4. Performing Ether deposit to mint a Comet..."
cast send \
    --mnemonic "$MNEMONIC" \
    --mnemonic-index 5 \
    --rpc-url "$RPC_URL" \
    0xfa2292f6D85ea4e629B156A4f99219e30D12EE17 \
    "depositEther(address,bytes)" \
    $APPLICATION_ADDRESS \
    0x7b22616374696f6e223a226a616d2e6d696e74222c20226a616d4944223a307d \
    --value 3ether

echo "Test script completed."
